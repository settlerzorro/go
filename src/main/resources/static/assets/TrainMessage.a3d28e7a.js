import{f as e,b as r,E as a,r as l,G as o,o as t,g as i,h as d,i as n,w as u,H as w,c,j as m,t as s,k as p,F as g,I as h}from"./vendor.be3cdc88.js";import{_ as N,p as y,v as b,w as z,x as f}from"./index.bb93dd95.js";const x={name:"trainMessage",setup(){const l=e(),o=r(localStorage.getItem("ms_userid")),t=a({fromStation:"大连",toStation:null,fromDate:null,userId:o,pageIndex:1,pageSize:5}),i=r(""),d=r(!1),n=r([]),u=r([]),w=r(0),c=()=>{t.toStation&&t.fromDate&&(d.value=!0,y(t).then((e=>{if(0==e.code){if(n.value=e.data,w.value=e.data.length,1==m.value)for(let r=0;r<e.data.length;r++)if(e.data[r].id==p){g(r,e.data[r]);break}}else h.error(e.message);d.value=!1})))};c();const m=r(!1),s=(e,r,a)=>{a.map((e=>{z(e.id).then((e=>{0==e.code?(h.success("取消收藏成功"),c()):h.error("取消收藏失败")})).catch((()=>{h.error("取消收藏失败")}))}))};let p="";const g=(e,r)=>{m.value=!0,p=r.id,r.commentTrains&&(u.value=r.commentTrains)};return{userId:o,loading:d,query:t,tableData:n,commentTableData:u,comment:i,pageTotal:w,commentVisible:m,handleSearch:()=>{t.pageIndex=1,c()},handlePageChange:e=>{t.pageIndex=e},viewComment:g,closeComment:()=>{m.value=!1,c()},handleLike:(e,r)=>{if(!o.value)return void l.push("/login");let a={userId:o.value,trainId:r.id};r.likes.length>0?s(0,{},r.likes):b(a).then((e=>{0==e.code?(h.success("收藏成功"),c()):h.error("收藏失败")})).catch((()=>{h.error("收藏失败")}))},handleDisLike:s,handleComment:(e,r)=>{if(!i.value)return void h.warning("请输入评论内容，不要无故刷评论");let a={userId:o.value,trainId:p,content:i.value};f(a).then((e=>{0==e.code?(h.success("评论成功"),c()):h.error("评论失败")})).catch((()=>{h.error("评论失败")}))},handleBuy:(e,r)=>{window.open(r.buyUrl,"_blank")},handleGetLike:(e,r)=>!!(r.likes&&r.likes.length>0)}}},v={class:"crumbs"},k=d("i",{class:"el-icon-lx-cascades"},null,-1),_=m(" 火车信息 "),C={class:"container"},P={class:"handle-box"},q=m("搜索"),I=d("div",null,"经停站点：",-1),V={key:0,class:"price"},S={key:0,class:"price"},D={key:0,class:"price"},j={key:0,class:"price"},T={key:0,class:"price"},Y={key:0,class:"price"},L={key:0,class:"price"},$={key:0,class:"price"},B={key:0,class:"price"},M={key:0,class:"price"},U={key:0,class:"price"},G=m("评论 "),E=m("购买地址"),F={class:"pagination"},H={style:{"text-align":"right"}},A=m("评论");var J=N(x,[["render",function(e,r,a,h,N,y){const b=l("el-breadcrumb-item"),z=l("el-breadcrumb"),f=l("el-input"),x=l("el-date-picker"),J=l("el-button"),K=l("el-table-column"),O=l("el-table"),Q=l("el-pagination"),R=l("el-dialog"),W=o("loading");return t(),i("div",null,[d("div",v,[n(z,{separator:"/"},{default:u((()=>[n(b,null,{default:u((()=>[k,_])),_:1})])),_:1})]),d("div",C,[d("div",P,[n(f,{modelValue:h.query.toStation,"onUpdate:modelValue":r[0]||(r[0]=e=>h.query.toStation=e),placeholder:"到达站点",class:"handle-input mr10"},null,8,["modelValue"]),n(x,{modelValue:h.query.fromDate,"onUpdate:modelValue":r[1]||(r[1]=e=>h.query.fromDate=e),placeholder:"发车日",type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"mr10"},null,8,["modelValue"]),n(J,{type:"primary",icon:"el-icon-search",onClick:h.handleSearch},{default:u((()=>[q])),_:1},8,["onClick"])]),w((t(),c(O,{data:h.tableData.slice((h.query.pageIndex-1)*h.query.pageSize,h.query.pageIndex*h.query.pageSize),border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:u((()=>[n(K,{prop:"index",label:"序号",width:"50"},{default:u((e=>[m(s(e.$index+1),1)])),_:1}),n(K,{type:"expand"},{default:u((e=>[I,d("div",null,s(e.row.trainLines),1)])),_:1}),n(K,{prop:"trainCode",label:"车次"}),n(K,{prop:"fromStation",label:"出发站点"}),n(K,{prop:"toStation",label:"到达站点"}),n(K,{prop:"fromTime",label:"出发时间",width:"100"}),n(K,{prop:"toTime",label:"到达时间",width:"100"}),n(K,{prop:"runTime",label:"运行时间",width:"100"}),n(K,{prop:"swzNum",label:"商务座/特等座",align:"center",width:"120px"},{default:u((e=>[m(s(e.row.swzNum?e.row.swzNum:"--")+" ",1),e.row.swzNum&&("有"==e.row.swzNum||e.row.swzNum>0)&&e.row.swzPrice?(t(),i("div",V,"票价：￥"+s(e.row.swzPrice),1)):p("",!0)])),_:1}),n(K,{prop:"ydzNum",label:"一等座",align:"center",width:"120px"},{default:u((e=>[m(s(e.row.ydzNum?e.row.ydzNum:"--")+" ",1),e.row.ydzNum&&("有"==e.row.ydzNum||e.row.ydzNum>0)&&e.row.ydzPrice?(t(),i("div",S,"票价：￥"+s(e.row.ydzPrice),1)):p("",!0)])),_:1}),n(K,{prop:"edzNum",label:"二等座",align:"center",width:"120px"},{default:u((e=>[m(s(e.row.edzNum?e.row.edzNum:"--")+" ",1),e.row.edzNum&&("有"==e.row.edzNum||e.row.edzNum>0)&&e.row.edzPrice?(t(),i("div",D,"票价：￥"+s(e.row.edzPrice),1)):p("",!0)])),_:1}),n(K,{prop:"gjrwNum",label:"高级软卧",align:"center",width:"120px"},{default:u((e=>[m(s(e.row.gjrwNum?e.row.gjrwNum:"--")+" ",1),e.row.gjrwNum&&("有"==e.row.gjrwNum||e.row.gjrwNum>0)&&e.row.gjrwPrice?(t(),i("div",j,"票价：￥"+s(e.row.gjrwPrice),1)):p("",!0)])),_:1}),n(K,{prop:"rwNum",label:"软卧/一等卧",align:"center",width:"120px"},{default:u((e=>[m(s(e.row.rwNum?e.row.rwNum:"--")+" ",1),e.row.rwNum&&("有"==e.row.rwNum||e.row.rwNum>0)&&e.row.rwPrice?(t(),i("div",T,"票价：￥"+s(e.row.rwPrice),1)):p("",!0)])),_:1}),n(K,{prop:"dwNum",label:"动卧",align:"center",width:"120px"},{default:u((e=>[m(s(e.row.dwNum?e.row.dwNum:"--")+" ",1),e.row.dwNum&&("有"==e.row.dwNum||e.row.dwNum>0)&&e.row.dwPrice?(t(),i("div",Y,"票价：￥"+s(e.row.dwPrice),1)):p("",!0)])),_:1}),n(K,{prop:"ywNum",label:"硬卧",align:"center",width:"120px"},{default:u((e=>[m(s(e.row.ywNum?e.row.ywNum:"--")+" ",1),e.row.ywNum&&("有"==e.row.ywNum||e.row.ywNum>0)&&e.row.ywPrice?(t(),i("div",L,"票价：￥"+s(e.row.ywPrice),1)):p("",!0)])),_:1}),n(K,{prop:"rzNum",label:"软座",align:"center",width:"120px"},{default:u((e=>[m(s(e.row.rzNum?e.row.rzNum:"--")+" ",1),e.row.rzNum&&("有"==e.row.rzNum||e.row.rzNum>0)&&e.row.rzPrice?(t(),i("div",$,"票价：￥"+s(e.row.rzPrice),1)):p("",!0)])),_:1}),n(K,{prop:"yzNum",label:"硬座",align:"center",width:"120px"},{default:u((e=>[m(s(e.row.yzNum?e.row.yzNum:"--")+" ",1),e.row.yzNum&&("有"==e.row.yzNum||e.row.yzNum>0)&&e.row.yzPrice?(t(),i("div",B,"票价：￥"+s(e.row.yzPrice),1)):p("",!0)])),_:1}),n(K,{prop:"wzNum",label:"无座",align:"center",width:"120px"},{default:u((e=>[m(s(e.row.wzNum?e.row.wzNum:"--")+" ",1),e.row.wzNum&&("有"==e.row.wzNum||e.row.wzNum>0)&&e.row.wzPrice?(t(),i("div",M,"票价：￥"+s(e.row.wzPrice),1)):p("",!0)])),_:1}),n(K,{prop:"qtNum",label:"其他",align:"center",width:"120px"},{default:u((e=>[m(s(e.row.qtNum?e.row.qtNum:"--")+" ",1),e.row.qtNum&&("有"==e.row.qtNum||e.row.qtNum>0)&&e.row.qtPrice?(t(),i("div",U,"票价：￥"+s(e.row.qtPrice),1)):p("",!0)])),_:1}),n(K,{label:"操作",width:"250",align:"center",fixed:"right"},{default:u((e=>[n(J,{type:"text",icon:"el-icon-lx-comment",class:"opButton",onClick:r=>h.viewComment(e.$index,e.row)},{default:u((()=>[G])),_:2},1032,["onClick"]),m(" "+s()+" ",1),n(J,{type:"text",icon:h.handleGetLike(e.$index,e.row)?"el-icon-lx-likefill":"el-icon-lx-like",class:"opButton red",onClick:r=>h.handleLike(e.$index,e.row)},{default:u((()=>[m(s(h.handleGetLike(e.$index,e.row)?"已收藏":"收藏"),1)])),_:2},1032,["icon","onClick"]),n(J,{type:"text",icon:"el-icon-lx-share",class:"opButton",onClick:r=>h.handleBuy(e.$index,e.row)},{default:u((()=>[E])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[W,h.loading]]),d("div",F,[n(Q,{background:"",layout:"total, prev, pager, next","current-page":h.query.pageIndex,"page-size":h.query.pageSize,total:h.pageTotal,onCurrentChange:h.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])]),n(R,{title:"评论",modelValue:h.commentVisible,"onUpdate:modelValue":r[3]||(r[3]=e=>h.commentVisible=e),width:"60%",onClose:h.closeComment},{default:u((()=>[n(O,{data:h.commentTableData,"max-height":"300",border:"",class:"table",ref:"commentTable","header-cell-class-name":"table-header"},{default:u((()=>[n(K,{prop:"index",label:"序号",width:"50"},{default:u((e=>[m(s(e.$index+1),1)])),_:1}),n(K,{prop:"content",label:"评论内容"}),n(K,{prop:"userId",label:"评论用户"},{default:u((e=>[m(" 用户"+s(e.row.userId),1)])),_:1}),n(K,{prop:"time",label:"评论时间"})])),_:1},8,["data"]),h.userId?(t(),i(g,{key:0},[n(f,{modelValue:h.comment,"onUpdate:modelValue":r[2]||(r[2]=e=>h.comment=e),type:"textarea",placeholder:"请输入评论",style:{margin:"16px 0"}},null,8,["modelValue"]),d("div",H,[n(J,{type:"primary",onClick:h.handleComment,style:{}},{default:u((()=>[A])),_:1},8,["onClick"])])],64)):p("",!0)])),_:1},8,["modelValue","onClose"])])}]]);export{J as default};
