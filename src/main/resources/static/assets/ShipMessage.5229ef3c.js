import{g as e,b as a,d as l,r as t,h as o,o as r,i,j as d,k as n,w as s,n as c,c as p,m as u,t as h,F as m,l as b,H as g}from"./vendor.ce047f19.js";import{_ as f,s as w,h as x,m as k,d as y}from"./index.3af46441.js";const v={name:"shipMessage",setup(){const t=e(),o=a(localStorage.getItem("ms_userid")),r=l({fromStation:"大连",toStation:null,userId:o,pageIndex:1,pageSize:5}),i=a(""),d=a(!1),n=a([]),s=a([]),c=a(0),p=()=>{r.toStation&&(d.value=!0,w(r).then((e=>{if(0==e.code){if(n.value=e.data,c.value=e.data.length,1==u.value)for(let a=0;a<e.data.length;a++)if(e.data[a].id==m){b(a,e.data[a]);break}}else g.error(e.message);d.value=!1})))};p();const u=a(!1),h=(e,a,l)=>{l.map((e=>{k(e.id).then((e=>{0==e.code?(g.success("取消收藏成功"),p()):g.error("取消收藏失败")})).catch((()=>{g.error("取消收藏失败")}))}))};let m="";const b=(e,a)=>{u.value=!0,m=a.id,a.commentShips&&(s.value=a.commentShips)};return{userId:o,loading:d,query:r,tableData:n,commentTableData:s,comment:i,pageTotal:c,commentVisible:u,handleSearch:()=>{r.pageIndex=1,p()},handlePageChange:e=>{r.pageIndex=e},viewComment:b,closeComment:()=>{u.value=!1,p()},handleLike:(e,a)=>{if(!o.value)return void t.push("/login");let l={userId:o.value,shipId:a.id};a.likeShips.length>0?h(0,{},a.likeShips):x(l).then((e=>{0==e.code?(g.success("收藏成功"),p()):g.error("收藏失败")})).catch((()=>{g.error("收藏失败")}))},handleDisLike:h,handleComment:(e,a)=>{if(!i.value)return void g.warning("请输入评论内容，不要无故刷评论");let l={userId:o.value,shipId:m,content:i.value};y(l).then((e=>{0==e.code?(g.success("评论成功"),p()):g.error("评论失败")})).catch((()=>{g.error("评论失败")}))},handleBuy:(e,a)=>{window.open(a.buyUrl,"_blank")},handleGetLike:(e,a)=>!!(a.likeShips&&a.likeShips.length>0)}}},_={class:"crumbs"},C=d("i",{class:"el-icon-lx-cascades"},null,-1),S=u(" 游轮信息 "),I={class:"container"},P={class:"handle-box"},V=u("搜索"),B=u("评论 "),q=u("购买地址"),T={class:"pagination"},$={style:{"text-align":"right"}},z=u("评论");var A=f(v,[["render",function(e,a,l,g,f,w){const x=t("el-breadcrumb-item"),k=t("el-breadcrumb"),y=t("el-input"),v=t("el-button"),A=t("el-table-column"),L=t("el-table"),D=t("el-pagination"),U=t("el-dialog"),j=o("loading");return r(),i("div",null,[d("div",_,[n(k,{separator:"/"},{default:s((()=>[n(x,null,{default:s((()=>[C,S])),_:1})])),_:1})]),d("div",I,[d("div",P,[n(y,{modelValue:g.query.toStation,"onUpdate:modelValue":a[0]||(a[0]=e=>g.query.toStation=e),placeholder:"抵达港",class:"handle-input mr10"},null,8,["modelValue"]),n(v,{type:"primary",icon:"el-icon-search",onClick:g.handleSearch},{default:s((()=>[V])),_:1},8,["onClick"])]),c((r(),p(L,{data:g.tableData.slice((g.query.pageIndex-1)*g.query.pageSize,g.query.pageIndex*g.query.pageSize),border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:s((()=>[n(A,{prop:"index",label:"序号",width:"50"},{default:s((e=>[u(h(e.$index+1),1)])),_:1}),n(A,{prop:"shipName",label:"船名",width:"150"}),n(A,{prop:"fromStation",label:"登船港",width:"150"}),n(A,{prop:"toStation",label:"抵达港",width:"150"}),n(A,{prop:"startTime",label:"出发时间",width:"100"}),n(A,{prop:"endTime",label:"到达时间",width:"100"}),n(A,{prop:"tdPrice",label:"特等价格",sortable:"",width:"110"},{default:s((e=>[u(h(e.row.tdPrice||"--"),1)])),_:1}),n(A,{prop:"ydPrice",label:"一等价格",sortable:"",width:"110"},{default:s((e=>[u(h(e.row.ydPrice||"--"),1)])),_:1}),n(A,{prop:"edAprice",label:"二等A价格",sortable:"",width:"120"},{default:s((e=>[u(h(e.row.edAprice||"--"),1)])),_:1}),n(A,{prop:"edBprice",label:"二等B价格",sortable:"",width:"120"},{default:s((e=>[u(h(e.row.edBprice||"--"),1)])),_:1}),n(A,{prop:"sdAPrice",label:"三等A价格",sortable:"",width:"120"},{default:s((e=>[u(h(e.row.sdAPrice||"--"),1)])),_:1}),n(A,{prop:"sdBPrice",label:"三等B价格",sortable:"",width:"120"},{default:s((e=>[u(h(e.row.sdBPrice||"--"),1)])),_:1}),n(A,{prop:"sdPrice",label:"四等价格",sortable:"",width:"110"},{default:s((e=>[u(h(e.row.sdPrice||"--"),1)])),_:1}),n(A,{prop:"sxPrice",label:"散席价格",sortable:"",width:"110"},{default:s((e=>[u(h(e.row.sxPrice||"--"),1)])),_:1}),n(A,{prop:"weather",label:"天气",width:"100"}),n(A,{prop:"scenicSpots",label:"景点",width:"100"}),n(A,{label:"操作",fixed:"right",width:"250",align:"center"},{default:s((e=>[n(v,{type:"text",icon:"el-icon-lx-comment",class:"opButton",onClick:a=>g.viewComment(e.$index,e.row)},{default:s((()=>[B])),_:2},1032,["onClick"]),u(" "+h()+" ",1),n(v,{type:"text",icon:g.handleGetLike(e.$index,e.row)?"el-icon-lx-likefill":"el-icon-lx-like",class:"opButton red",onClick:a=>g.handleLike(e.$index,e.row)},{default:s((()=>[u(h(g.handleGetLike(e.$index,e.row)?"已收藏":"收藏"),1)])),_:2},1032,["icon","onClick"]),n(v,{type:"text",icon:"el-icon-lx-share",class:"opButton",onClick:a=>g.handleBuy(e.$index,e.row)},{default:s((()=>[q])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[j,g.loading]]),d("div",T,[n(D,{background:"",layout:"total, prev, pager, next","current-page":g.query.pageIndex,"page-size":g.query.pageSize,total:g.pageTotal,onCurrentChange:g.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])]),n(U,{title:"评论",modelValue:g.commentVisible,"onUpdate:modelValue":a[2]||(a[2]=e=>g.commentVisible=e),width:"60%",onClose:g.closeComment},{default:s((()=>[n(L,{data:g.commentTableData,"max-height":"300",border:"",class:"table",ref:"commentTable","header-cell-class-name":"table-header"},{default:s((()=>[n(A,{prop:"index",label:"序号",width:"50"},{default:s((e=>[u(h(e.$index+1),1)])),_:1}),n(A,{prop:"content",label:"评论内容"}),n(A,{prop:"userId",label:"评论用户"},{default:s((e=>[u(" 用户"+h(e.row.userId),1)])),_:1}),n(A,{prop:"time",label:"评论时间"})])),_:1},8,["data"]),g.userId?(r(),i(m,{key:0},[n(y,{modelValue:g.comment,"onUpdate:modelValue":a[1]||(a[1]=e=>g.comment=e),type:"textarea",placeholder:"请输入评论",style:{margin:"16px 0"}},null,8,["modelValue"]),d("div",$,[n(v,{type:"primary",onClick:g.handleComment,style:{}},{default:s((()=>[z])),_:1},8,["onClick"])])],64)):b("",!0)])),_:1},8,["modelValue","onClose"])])}]]);export{A as default};
