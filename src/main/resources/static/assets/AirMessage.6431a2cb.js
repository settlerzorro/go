import{f as e,b as a,D as l,r as t,E as n,o,g as r,h as i,i as d,w as s,G as u,c,j as m,t as p,F as h,k as g,H as b}from"./vendor.c7f77ec0.js";import{_ as f,o as x,l as y,j as k,c as v}from"./index.2b53616f.js";const C={name:"airMessage",setup(){const t=e(),n=a(localStorage.getItem("ms_userid")),o=l({oapName:"大连",aapName:null,fromTime:null,userId:n,pageIndex:1,pageSize:5}),r=a(""),i=a(!1),d=a([]),s=a([]),u=a(0),c=()=>{o.aapName&&o.fromTime&&(i.value=!0,x(o).then((e=>{if(0==e.code){if(d.value=e.data,u.value=e.data.length,1==m.value)for(let a=0;a<e.data.length;a++)if(e.data[a].id==h){g(a,e.data[a]);break}}else b.error(e.message);i.value=!1})))};c();const m=a(!1),p=(e,a,l)=>{l.map((e=>{k(e.id).then((e=>{0==e.code?(b.success("取消收藏成功"),c()):b.error("取消收藏失败")})).catch((()=>{b.error("取消收藏失败")}))}))};let h="";const g=(e,a)=>{m.value=!0,h=a.id,a.commentAairs&&(s.value=a.commentAairs)};return{userId:n,loading:i,query:o,tableData:d,commentTableData:s,comment:r,pageTotal:u,commentVisible:m,handleSearch:()=>{o.pageIndex=1,c()},handlePageChange:e=>{o.pageIndex=e},viewComment:g,closeComment:()=>{m.value=!1,c()},handleLike:(e,a)=>{if(!n.value)return void t.push("/login");let l={userId:n.value,airId:a.id};a.likeAirs.length>0?p(0,{},a.likeAirs):y(l).then((e=>{0==e.code?(b.success("收藏成功"),c()):b.error("收藏失败")})).catch((()=>{b.error("收藏失败")}))},handleDisLike:p,handleComment:(e,a)=>{if(!r.value)return void b.warning("请输入评论内容，不要无故刷评论");let l={userId:n.value,airId:h,content:r.value};v(l).then((e=>{0==e.code?(b.success("评论成功"),c()):b.error("评论失败")})).catch((()=>{b.error("评论失败")}))},handleBuy:(e,a)=>{window.open(a.buyUrl,"_blank")},handleGetLike:(e,a)=>!!(a.likeAirs&&a.likeAirs.length>0)}}},w={class:"crumbs"},_=i("i",{class:"el-icon-lx-cascades"},null,-1),I=m(" 航班信息 "),V={class:"container"},T={class:"handle-box"},q=m("搜索"),D=m("评论 "),Y=m("购买地址"),N={class:"pagination"},S={style:{"text-align":"right"}},$=m("评论");var z=f(C,[["render",function(e,a,l,b,f,x){const y=t("el-breadcrumb-item"),k=t("el-breadcrumb"),v=t("el-input"),C=t("el-date-picker"),z=t("el-button"),A=t("el-table-column"),L=t("el-table"),B=t("el-pagination"),M=t("el-dialog"),U=n("loading");return o(),r("div",null,[i("div",w,[d(k,{separator:"/"},{default:s((()=>[d(y,null,{default:s((()=>[_,I])),_:1})])),_:1})]),i("div",V,[i("div",T,[d(v,{modelValue:b.query.aapName,"onUpdate:modelValue":a[0]||(a[0]=e=>b.query.aapName=e),placeholder:"到达站点",class:"handle-input mr10"},null,8,["modelValue"]),d(C,{modelValue:b.query.fromTime,"onUpdate:modelValue":a[1]||(a[1]=e=>b.query.fromTime=e),placeholder:"出发日",type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",class:"mr10"},null,8,["modelValue"]),d(z,{type:"primary",icon:"el-icon-search",onClick:b.handleSearch},{default:s((()=>[q])),_:1},8,["onClick"])]),u((o(),c(L,{data:b.tableData.slice((b.query.pageIndex-1)*b.query.pageSize,b.query.pageIndex*b.query.pageSize),border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:s((()=>[d(A,{prop:"index",label:"序号",width:"50"},{default:s((e=>[m(p(e.$index+1),1)])),_:1}),d(A,{prop:"oapName",label:"出发站点"}),d(A,{prop:"aapName",label:"到达站点"}),d(A,{prop:"si",label:"经停",width:"80"},{default:s((e=>[m(p(e.row.si||"无"),1)])),_:1}),d(A,{prop:"flyOffOnlyTime",label:"出发时刻",width:"100"}),d(A,{prop:"arrivalOnlyTime",label:"到达时刻",width:"100"}),d(A,{prop:"useTime",label:"总用时",width:"100"}),d(A,{prop:"aep",label:"价格",width:"100"}),d(A,{label:"操作",width:"250",align:"center"},{default:s((e=>[d(z,{type:"text",icon:"el-icon-lx-comment",class:"opButton",onClick:a=>b.viewComment(e.$index,e.row)},{default:s((()=>[D])),_:2},1032,["onClick"]),m(" "+p()+" ",1),d(z,{type:"text",icon:b.handleGetLike(e.$index,e.row)?"el-icon-lx-likefill":"el-icon-lx-like",class:"opButton red",onClick:a=>b.handleLike(e.$index,e.row)},{default:s((()=>[m(p(b.handleGetLike(e.$index,e.row)?"已收藏":"收藏"),1)])),_:2},1032,["icon","onClick"]),d(z,{type:"text",icon:"el-icon-lx-share",class:"opButton",onClick:a=>b.handleBuy(e.$index,e.row)},{default:s((()=>[Y])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[U,b.loading]]),i("div",N,[d(B,{background:"",layout:"total, prev, pager, next","current-page":b.query.pageIndex,"page-size":b.query.pageSize,total:b.pageTotal,onCurrentChange:b.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])]),d(M,{title:"评论",modelValue:b.commentVisible,"onUpdate:modelValue":a[3]||(a[3]=e=>b.commentVisible=e),width:"60%",onClose:b.closeComment},{default:s((()=>[d(L,{data:b.commentTableData,"max-height":"300",border:"",class:"table",ref:"commentTable","header-cell-class-name":"table-header"},{default:s((()=>[d(A,{prop:"index",label:"序号",width:"50"},{default:s((e=>[m(p(e.$index+1),1)])),_:1}),d(A,{prop:"content",label:"评论内容"}),d(A,{prop:"userId",label:"评论用户"},{default:s((e=>[m(" 用户"+p(e.row.userId),1)])),_:1}),d(A,{prop:"time",label:"评论时间"})])),_:1},8,["data"]),b.userId?(o(),r(h,{key:0},[d(v,{modelValue:b.comment,"onUpdate:modelValue":a[2]||(a[2]=e=>b.comment=e),type:"textarea",placeholder:"请输入评论",style:{margin:"16px 0"}},null,8,["modelValue"]),i("div",S,[d(z,{type:"primary",onClick:b.handleComment,style:{}},{default:s((()=>[$])),_:1},8,["onClick"])])],64)):g("",!0)])),_:1},8,["modelValue","onClose"])])}]]);export{z as default};
