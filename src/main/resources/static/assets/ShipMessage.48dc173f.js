import{f as e,b as a,D as l,r as t,E as o,o as i,g as r,h as n,i as d,w as s,G as c,c as u,j as p,t as h,F as m,k as b,H as g}from"./vendor.c7f77ec0.js";import{_ as f,s as w,h as x,m as k,d as y}from"./index.2b53616f.js";const v={name:"shipMessage",setup(){const t=e(),o=a(localStorage.getItem("ms_userid")),i=l({fromStation:"大连",toStation:null,userId:o,pageIndex:1,pageSize:5}),r=a(""),n=a(!1),d=a([]),s=a([]),c=a(0),u=()=>{i.toStation&&(n.value=!0,w(i).then((e=>{if(0==e.code){if(d.value=e.data,c.value=e.data.length,1==p.value)for(let a=0;a<e.data.length;a++)if(e.data[a].id==m){b(a,e.data[a]);break}}else g.error(e.message);n.value=!1})))};u();const p=a(!1),h=(e,a,l)=>{l.map((e=>{k(e.id).then((e=>{0==e.code?(g.success("取消收藏成功"),u()):g.error("取消收藏失败")})).catch((()=>{g.error("取消收藏失败")}))}))};let m="";const b=(e,a)=>{p.value=!0,m=a.id,a.commentShips&&(s.value=a.commentShips)};return{userId:o,loading:n,query:i,tableData:d,commentTableData:s,comment:r,pageTotal:c,commentVisible:p,handleSearch:()=>{i.pageIndex=1,u()},handlePageChange:e=>{i.pageIndex=e},viewComment:b,closeComment:()=>{p.value=!1,u()},handleLike:(e,a)=>{if(!o.value)return void t.push("/login");let l={userId:o.value,shipId:a.id};a.likeShips.length>0?h(0,{},a.likeShips):x(l).then((e=>{0==e.code?(g.success("收藏成功"),u()):g.error("收藏失败")})).catch((()=>{g.error("收藏失败")}))},handleDisLike:h,handleComment:(e,a)=>{if(!r.value)return void g.warning("请输入评论内容，不要无故刷评论");let l={userId:o.value,shipId:m,content:r.value};y(l).then((e=>{0==e.code?(g.success("评论成功"),u()):g.error("评论失败")})).catch((()=>{g.error("评论失败")}))},handleBuy:(e,a)=>{window.open(a.buyUrl,"_blank")},handleGetLike:(e,a)=>!!(a.likeShips&&a.likeShips.length>0)}}},_={class:"crumbs"},C=n("i",{class:"el-icon-lx-cascades"},null,-1),S=p(" 游轮信息 "),I={class:"container"},P={class:"handle-box"},V=p("搜索"),B=p("评论 "),q=p("购买地址"),T={class:"pagination"},$={style:{"text-align":"right"}},z=p("评论");var A=f(v,[["render",function(e,a,l,g,f,w){const x=t("el-breadcrumb-item"),k=t("el-breadcrumb"),y=t("el-input"),v=t("el-button"),A=t("el-table-column"),D=t("el-table"),L=t("el-pagination"),G=t("el-dialog"),U=o("loading");return i(),r("div",null,[n("div",_,[d(k,{separator:"/"},{default:s((()=>[d(x,null,{default:s((()=>[C,S])),_:1})])),_:1})]),n("div",I,[n("div",P,[d(y,{modelValue:g.query.toStation,"onUpdate:modelValue":a[0]||(a[0]=e=>g.query.toStation=e),placeholder:"抵达港",class:"handle-input mr10"},null,8,["modelValue"]),d(v,{type:"primary",icon:"el-icon-search",onClick:g.handleSearch},{default:s((()=>[V])),_:1},8,["onClick"])]),c((i(),u(D,{data:g.tableData.slice((g.query.pageIndex-1)*g.query.pageSize,g.query.pageIndex*g.query.pageSize),border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:s((()=>[d(A,{prop:"index",label:"序号",width:"50"},{default:s((e=>[p(h(e.$index+1),1)])),_:1}),d(A,{prop:"shipName",label:"船名",width:"150"}),d(A,{prop:"fromStation",label:"登船港",width:"150"}),d(A,{prop:"toStation",label:"抵达港",width:"150"}),d(A,{prop:"startTime",label:"出发时间",width:"100"}),d(A,{prop:"endTime",label:"到达时间",width:"100"}),d(A,{prop:"tdPrice",label:"特等价格",width:"100"},{default:s((e=>[p(h(e.row.tdPrice||"--"),1)])),_:1}),d(A,{prop:"ydPrice",label:"一等价格",width:"100"},{default:s((e=>[p(h(e.row.ydPrice||"--"),1)])),_:1}),d(A,{prop:"edAprice",label:"二等A价格",width:"100"},{default:s((e=>[p(h(e.row.edAprice||"--"),1)])),_:1}),d(A,{prop:"edBprice",label:"二等B价格",width:"100"},{default:s((e=>[p(h(e.row.edBprice||"--"),1)])),_:1}),d(A,{prop:"sdAPrice",label:"三等A价格",width:"100"},{default:s((e=>[p(h(e.row.sdAPrice||"--"),1)])),_:1}),d(A,{prop:"sdBPrice",label:"三等B价格",width:"100"},{default:s((e=>[p(h(e.row.sdBPrice||"--"),1)])),_:1}),d(A,{prop:"sdPrice",label:"四等价格",width:"100"},{default:s((e=>[p(h(e.row.sdPrice||"--"),1)])),_:1}),d(A,{prop:"sxPrice",label:"散席价格",width:"100"},{default:s((e=>[p(h(e.row.sxPrice||"--"),1)])),_:1}),d(A,{label:"操作",fixed:"right",width:"250",align:"center"},{default:s((e=>[d(v,{type:"text",icon:"el-icon-lx-comment",class:"opButton",onClick:a=>g.viewComment(e.$index,e.row)},{default:s((()=>[B])),_:2},1032,["onClick"]),p(" "+h()+" ",1),d(v,{type:"text",icon:g.handleGetLike(e.$index,e.row)?"el-icon-lx-likefill":"el-icon-lx-like",class:"opButton red",onClick:a=>g.handleLike(e.$index,e.row)},{default:s((()=>[p(h(g.handleGetLike(e.$index,e.row)?"已收藏":"收藏"),1)])),_:2},1032,["icon","onClick"]),d(v,{type:"text",icon:"el-icon-lx-share",class:"opButton",onClick:a=>g.handleBuy(e.$index,e.row)},{default:s((()=>[q])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])),[[U,g.loading]]),n("div",T,[d(L,{background:"",layout:"total, prev, pager, next","current-page":g.query.pageIndex,"page-size":g.query.pageSize,total:g.pageTotal,onCurrentChange:g.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])]),d(G,{title:"评论",modelValue:g.commentVisible,"onUpdate:modelValue":a[2]||(a[2]=e=>g.commentVisible=e),width:"60%",onClose:g.closeComment},{default:s((()=>[d(D,{data:g.commentTableData,"max-height":"300",border:"",class:"table",ref:"commentTable","header-cell-class-name":"table-header"},{default:s((()=>[d(A,{prop:"index",label:"序号",width:"50"},{default:s((e=>[p(h(e.$index+1),1)])),_:1}),d(A,{prop:"content",label:"评论内容"}),d(A,{prop:"userId",label:"评论用户"},{default:s((e=>[p(" 用户"+h(e.row.userId),1)])),_:1}),d(A,{prop:"time",label:"评论时间"})])),_:1},8,["data"]),g.userId?(i(),r(m,{key:0},[d(y,{modelValue:g.comment,"onUpdate:modelValue":a[1]||(a[1]=e=>g.comment=e),type:"textarea",placeholder:"请输入评论",style:{margin:"16px 0"}},null,8,["modelValue"]),n("div",$,[d(v,{type:"primary",onClick:g.handleComment,style:{}},{default:s((()=>[z])),_:1},8,["onClick"])])],64)):b("",!0)])),_:1},8,["modelValue","onClose"])])}]]);export{A as default};
